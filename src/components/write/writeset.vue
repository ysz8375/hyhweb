<template lang="html">
  <div class="editor">
    <div ref="toolbar" class="toolbar">
    </div>
    <div ref="editor" class="text">
    </div>
  </div>
</template>

<script>
import E from "wangeditor";
export default {
  name: "editoritem",
  data() {
    return {
      // uploadPath,
      editor: null,
      info_: null,
    };
  },
  model: {
    prop: "value",
    event: "change",
  },
  props: {
    value: {
      type: String,
      default: "",
    },
    isClear: {
      type: Boolean,
      default: false,
    },
  },
  watch: {
    isClear(val) {
      // è§¦å‘æ¸…é™¤æ–‡æœ¬åŸŸå†…å®¹
      if (val) {
        this.editor.txt.clear();
        this.info_ = null;
      }
    },
    value: function (value) {
      if (value !== this.editor.txt.html()) {
        this.editor.txt.html(this.value);
      }
    },
    //valueä¸ºç¼–è¾‘æ¡†è¾“å…¥çš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘ç›‘å¬äº†ä¸€ä¸‹å€¼ï¼Œå½“çˆ¶ç»„ä»¶è°ƒç”¨å¾—æ—¶å€™ï¼Œå¦‚æœç»™valueèµ‹å€¼äº†ï¼Œå­ç»„ä»¶å°†ä¼šæ˜¾ç¤ºçˆ¶ç»„ä»¶èµ‹ç»™çš„å€¼
  },
  mounted() {
    this.seteditor();
    this.editor.txt.html(this.value);
  },
  methods: {
    seteditor() {
      this.editor = new E(this.$refs.toolbar, this.$refs.editor);
      this.editor.customConfig.uploadImgShowBase64 = false; // base 64 å­˜å‚¨å›¾ç‰‡
      this.editor.customConfig.uploadImgServer = "https://upload.qiniup.com/"; // é…ç½®æœåŠ¡å™¨ç«¯åœ°å€
      this.editor.customConfig.uploadImgParams = {
        token:
          "UugibeFm8mDErUcSRF-vc-oEN98pBejmQuNoXGuG:A5c8Zf_xBDlHMfNOGKwDJwO4ONc=:eyJzY29wZSI6InN0YXRpYyIsImRlYWRsaW5lIjoxNTk3OTk2NjMxfQ==",
      };
      this.editor.customConfig.uploadFileName = "file"; // åç«¯æ¥å—ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°å
      this.editor.customConfig.uploadImgMaxSize = 2 * 1024 * 1024; // å°†å›¾ç‰‡å¤§å°é™åˆ¶ä¸º 2M
      this.editor.customConfig.uploadImgMaxLength = 6; // é™åˆ¶ä¸€æ¬¡æœ€å¤šä¸Šä¼  3 å¼ å›¾ç‰‡
      this.editor.customConfig.uploadImgTimeout = 3 * 60 * 1000; // è®¾ç½®è¶…æ—¶æ—¶é—´
      this.editor.customConfig.emotions = [
        {
          title: "ç¼–ç¨‹çŒ«",
          type: "image",
          content: [
            {
              alt: "[ç¼–ç¨‹çŒ«_æ“å¤´]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_æ“å¤´.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_ç‚¹èµ]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_ç‚¹èµ.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_ç¿»ç™½çœ¼]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_ç¿»ç™½çœ¼.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_å—¨èµ·æ¥]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_å—¨èµ·æ¥.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_åŠ æ²¹]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_åŠ æ²¹.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_å†·æ¼ ]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_å†·æ¼ .gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_ç´§å¼ ]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_ç´§å¼ .gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_å‰å®³äº†]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_å‰å®³äº†.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_æ—©å‘€]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_æ—©å‘€.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_æºœäº†æºœäº†]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_æºœäº†æºœäº†.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_ä¼¤å¿ƒ]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_ä¼¤å¿ƒ.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_è€èµ–]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_è€èµ–.gif",
            },
            {
              alt: "[ç¼–ç¨‹çŒ«_æ™šå®‰]",
              src:
                "https://static.codemao.cn/emoji/codemao/ç¼–ç¨‹çŒ«_æ™šå®‰.gif",
            },
          ],
        },
        {
          title: "emoji",
          type: "emoji",
          content: ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†"],
        },
      ];

      // é…ç½®èœå•
      this.editor.customConfig.menus = [
        "head", // æ ‡é¢˜
        "bold", // ç²—ä½“
        "fontSize", // å­—å·
        "fontName", // å­—ä½“
        "italic", // æ–œä½“
        "underline", // ä¸‹åˆ’çº¿
        "strikeThrough", // åˆ é™¤çº¿
        "foreColor", // æ–‡å­—é¢œè‰²
        "backColor", // èƒŒæ™¯é¢œè‰²
        "justify", // å¯¹é½æ–¹å¼
        "quote", // å¼•ç”¨
        "emoticon", // è¡¨æƒ…
        "image", // æ’å…¥å›¾ç‰‡
        "code", // æ’å…¥ä»£ç 
      ];

      this.editor.customConfig.uploadImgHooks = {
        //   fail: (xhr, editor, result) => {
        //     // æ’å…¥å›¾ç‰‡å¤±è´¥å›è°ƒ
        //   },
        //   success: (xhr, editor, result) => {
        //     // å›¾ç‰‡ä¸Šä¼ æˆåŠŸå›è°ƒ
        //   },
        //   error: (xhr, editor) => {
        //     // å›¾ç‰‡ä¸Šä¼ é”™è¯¯çš„å›è°ƒ
        //   },
        customInsert: (insertImg, result) => {
          // å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œæ’å…¥å›¾ç‰‡çš„å›è°ƒ
          //resultä¸ºä¸Šä¼ å›¾ç‰‡æˆåŠŸçš„æ—¶å€™è¿”å›çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘æ‰“å°äº†ä¸€ä¸‹å‘ç°åå°è¿”å›çš„æ˜¯dataï¼š[{url:"è·¯å¾„çš„å½¢å¼"},...]
          // console.log(result.data[0].url)
          //insertImg()ä¸ºæ’å…¥å›¾ç‰‡çš„å‡½æ•°
          //å¾ªç¯æ’å…¥å›¾ç‰‡
          // for (let i = 0; i < 1; i++) {
          let url = "https://static.codemao.cn/" + result.hash;
          insertImg(url);
          // }
        },
      };
      this.editor.customConfig.onchange = (html) => {
        this.info_ = html; // ç»‘å®šå½“å‰é€æ¸åœ°å€¼
        this.$emit("change", this.info_); // å°†å†…å®¹åŒæ­¥åˆ°çˆ¶ç»„ä»¶ä¸­
      };
      // åˆ›å»ºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
      this.editor.create();
    },
  },
};
</script>

<style lang="css">
.editor {
  width: 100%;
  margin: 0 auto;
  position: relative;
  z-index: 0;
  border-radius: 10px;
}
.toolbar {
  position: sticky;
  top: 0;
  z-index: 10001;
  background: #fff;
}
.text {
  border: 1px solid #dddddd;
  min-height: 400px;
}
</style>